# 2. 관계 데이터 모델

# 1. 관계 데이터 모델의 개념

## 릴레이션

행과 열로 구성된 테이블, 수학의 집합에서 나온 개념

- **관계(Relationship)**
  - 릴레이션 내 데이터들의 관계
  - 릴레이션 간의 관계

<br>

## 릴레이션 스키마와 인스턴스

<br>
<p align="center"><img src="https://user-images.githubusercontent.com/79684339/210802972-c4fdb7b4-c5f9-4799-bad4-24e8504150d5.png" width="480" height="300"></p>
<br>

- **스키마(Schema)**  
  관계 데이터베이스의 릴레이션이 어떻게 구성되는지, 어떤 정보를 담고 있는지에 대한 기본적인 구조
- **인스턴스(Instance)**  
  실제 저장되는 데이터의 집합
- **릴레이션 스키마(Relation Schema)**  
  릴레이션에 어떤 정보가 담길지를 정의한 것
  - 속성(Attribute): 릴레이션 스키마의 열
  - 도메인(Domain): 속성이 가질 수 있는 값의 집합
  - 차수(Degree): 속성의 개수
- **릴레이션 인스턴스(Relation Instance)**  
  릴레이션 스키마에 실제로 저장된 데이터의 집합
  - 투플(Tuple): 릴레이션의 행
  - 카디날리티(Cardinality): 투플의 수

<br>

## 릴레이션의 특징

1. 속성은 단일 값임
2. 속성은 서로 다른 이름을 가짐
3. 한 속성의 값은 모두 같은 도메인 값을 가짐
4. 속성의 순서는 상관없음
5. 릴레이션 내의 중복된 투플은 허용하지 않음
6. 투플의 순서는 상관없음

<br>

## 관계 데이터 모델

데이터를 릴레이션으로 표현하며, 릴레이션에 대한 제약조건과 관계 연산을 위한 관계대수를 정의한 것

<br>

# 2. 무결성 제약조건

## 키

키가 되는 속성(혹은 속성의 집합은)은 반드시 값이 달라서 서로 구별할 수 있어야 함

1. 릴레이션에서 특정 투플을 식별할 때 사용
2. 릴레이션 간의 관계를 맺는 데 사용

- **슈퍼키(Super Key)**  
  투플을 유일하게 식별할 수 있는 하나의 속성 혹은 속성의 집합
- **후보키(Candidate Key)**  
  투플을 유일하게 식별할 수 있는 속성의 최소 집합
- **기본키(Primary Key)**  
  여러 후보키 중 하나를 선정하여 대표로 삼는 키
  - 제약 조건
    - 릴레이션 내 투플을 식별할 수 있는 고유한 값을 가져야 함
    - NULL 값은 허용하지 않음
    - 키 값의 변동이 일어나지 않아야 함
    - 최대한 적은 수의 속성을 가진 것이어야 함
    - 향후 키를 사용하는 데 있어서 문제 발생 소지가 없어야 함
- **대체키(Alternate Key)**  
  기본키로 선정되지 않은 후보키
- **대리키(Surrogate Key) or 인조키(Artificial Key)**  
  기본키가 보안을 요하거나, 여러 개의 속성으로 구성되어 복잡하거나, 마땅한 기본키가 없을 때 일련번호 같은 가상의 속성을 만들어 기본키로 사용
- **외래키(Foreign Key)**
  - 다른 릴레이션의 기본키를 참조하는 속성
  - 관계 데이터 모델의 릴레이션 간의 관계를 표현함
  - 참조하고 참조되는 양쪽 릴레이션의 도메인은 서로 같아야 함
  - 참조되는 값이 변경되면 참조하는 값도 변경
  - NULL 값과 중복 값 등 허용
  - 자기 자신의 기본키를 참조하는 외래키도 가능
  - 외래키가 기본키의 일부가 될 수 있음

<br>

## 무결성 제약조건

데이터베이스에 저장된 데이터의 일관성과 정확성을 지키는 것

- **도메인 무결성 제약조건(도메인 제약)**  
  릴레이션 내의 투플들이 각 속성의 도메인에 지정된 값을 가져야 함
- **개체 무결성 제약조건(기본키 제약)**  
  기본키는 NULL값을 가져서는 안되며 릴레이션 내에 오직 하나의 값만 존재해야 함
- **참조 무결성 제약조건(외래키 제약)**  
  자식 릴레이션의 외래키는 부모 릴레이션의 기본키와 도메인이 동일해야 하며, 자식 릴레이션의 값이 변경될 때 부모 릴레이션의 제약을 받음

<br>

## 무결성 제약조건의 수행

제약조건의 준수 여부는 데이터의 변경이 있을 때마다 확인해야 함

- **개체 무결성 제약조건**
- **참조 무결성 제약조건**
  - 옵션
    | 명령어 | 의미 |
    | ---------- | ----------------------------------------------------------------------- |
    | RESTRICTED | 자식 릴레이션에서 참조하고 있을 경우 부모 릴레이션의 삭제 작업을 거부함 |
    | CASCADE | 자식 릴레이션의 관련 투플을 같이 삭제함 |
    | DEFAULT | 자식 릴레이션의 관련 투플을 미리 설정해둔 값으로 변경함 |
    | NULL | 자식 릴레이션의 관련 투플을 NULL 값으로 설정함 |

<br>

# 3. 관계대수

## 관계대수

릴레이션에서 원하는 결과를 얻기 위해 수학의 대수와 같은 연산을 이용하여 질의하는 방법을 기술하는 언어

- **관계의 수학적 의미**  
  관계 데이터베이스는 릴레이션이라는 수학적 개념에 기초함
- **관계대수 연산자**
  - 순수 관계 연산: selection, projection, join, division, rename
  - 일반 집합 연산: union, difference, intersection, cartesian product
    | 기본 | 대상 | 연산자 이름 | 기호 | 설명 |
    | ---- | ---- | ----------------- | ---- | ------------------------------------------------------------------------------- |
    | 기본 | 단항 | selection | σ | 릴레이션에서 조건에 만족하는 투플을 선택 |
    | 기본 | 단항 | projection | π | 릴레이션의 속성을 선택 |
    | 추가 | 단항 | rename | ρ | 릴레이션이나 속성의 이름을 변경 |
    | 유도 | 이항 | division | ÷ | 부모 릴레이션에 포함된 투플의 값을 모두 갖고 있는 투플을 분자 릴레이션에서 추출 |
    | 기본 | 이항 | union | ∪ | 두 릴레이션의 합집합 |
    | 기본 | 이항 | difference | — | 두 릴레이션의 차집합 |
    | 유도 | 이항 | intersection | ∩ | 두 릴레이션의 교집합 |
    | 기본 | 이항 | cartesian product | × | 두 릴레이션에 속한 모든 투플의 집합 |
- **관계대수식**
  - 단항 연산자: 연산자<조건> 릴레이션
  - 이항 연산자: 릴레이션1 연산자<조건> 릴레이션2

<br>

## 셀렉션과 프로젝션

- **셀렉션(Selection)**  
   릴레이션의 투플을 추출하기 위한 연산, 찾고자 하는 투플의 조건을 명시하고 그 조건에 만족하는 투플을 반환

  > 예시)  
  > Q. 서점에서 판매하는 도서 중 8,000원 이하인 도서를 검색하시오.
  >
  > [도서]
  >
  > | 도서번호 | 이름          | 출판사     | 가격  |
  > | -------- | ------------- | ---------- | ----- |
  > | 1        | 축구의 역사   | 굿스포츠   | 7000  |
  > | 2        | 축구아는 여자 | 나무수     | 13000 |
  > | 3        | 축구의 이해   | 대한미디어 | 22000 |
  > | 4        | 골프 바이블   | 대한미디어 | 35000 |
  >
  > A. σ가격＜=8000 (도서)
  >
  > | 도서번호 | 이름        | 출판사   | 가격 |
  > | -------- | ----------- | -------- | ---- |
  > | 1        | 축구의 역사 | 굿스포츠 | 7000 |

- **프로젝션(Projection)**  
  릴레이션의 속성을 추출하기 위한 연산
  > 예시)  
  > Q. 고객 릴레이션에서 (이름, 주소, 핸드폰)의 카탈로그 주소록을 만드시오.
  >
  > [고객]
  >
  > | 고객번호 | 이름   | 주민번호       | 주소     | 핸드폰        |
  > | -------- | ------ | -------------- | -------- | ------------- |
  > | 1        | 박지성 | 810000-0000000 | 영국     | 010-5000-0001 |
  > | 2        | 김연아 | 900000-0000000 | 대한민국 | 010-6000-0001 |
  > | 3        | 장미란 | 830000-0000000 | 대한민국 | 010-7000-0001 |
  > | 4        | 추신수 | 820000-0000000 | 미국     |               |
  >
  > A. π이름,주소,핸드폰 (고객)
  >
  > | 이름   | 주소     | 핸드폰        |
  > | ------ | -------- | ------------- |
  > | 박지성 | 영국     | 010-5000-0001 |
  > | 김연아 | 대한민국 | 010-6000-0001 |
  > | 장미란 | 대한민국 | 010-7000-0001 |
  > | 추신수 | 미국     | 010-8000-0001 |

<br>

## 집합 연산

수학의 집한 연산과 같은 연산, 카티전 프로덕트를 제외한 집합 연산은 각 릴레이션의 속성 수가 같고 순서도 같아야 하며 각각 동일한 도메인으로 대응되어야 함(Union Compatible)

- **합집합(Union)**  
  두 개의 릴레이션을 합하여 하나의 릴레이션을 반환, 두 개의 릴레이션은 서로 같은 속성 순서와 도메인을 가져야 함
  > 예시)  
  > [도서A]
  >
  > | 도서번호 | 이름          | 출판사     | 가격  |
  > | -------- | ------------- | ---------- | ----- |
  > | 1        | 축구의 역사   | 굿스포츠   | 7000  |
  > | 2        | 축구아는 여자 | 나무수     | 13000 |
  > | 3        | 축구의 이해   | 대한미디어 | 22000 |
  >
  > [도서B]
  >
  > | 도서번호 | 이름        | 출판사     | 가격  |
  > | -------- | ----------- | ---------- | ----- |
  > | 1        | 축구의 역사 | 굿스포츠   | 7000  |
  > | 4        | 골프 바이블 | 대한미디어 | 35000 |
  > | 5        | 피겨 교본   | 굿스포츠   | 8000  |
  >
  > == 도서A ∪ 도서B
  >
  > | 도서번호 | 이름          | 출판사     | 가격  |
  > | -------- | ------------- | ---------- | ----- |
  > | 1        | 축구의 역사   | 굿스포츠   | 7000  |
  > | 2        | 축구아는 여자 | 나무수     | 13000 |
  > | 3        | 축구의 이해   | 대한미디어 | 22000 |
  > | 4        | 골프 바이블   | 대한미디어 | 35000 |
  > | 5        | 피겨 교본     | 굿스포츠   | 8000  |
- **교집합(Intersection)**  
  두 릴레이션이 공통으로 가지고 있는 투플을 반환
  > 예시)  
  > [도서A]
  >
  > | 도서번호 | 이름          | 출판사     | 가격  |
  > | -------- | ------------- | ---------- | ----- |
  > | 1        | 축구의 역사   | 굿스포츠   | 7000  |
  > | 2        | 축구아는 여자 | 나무수     | 13000 |
  > | 3        | 축구의 이해   | 대한미디어 | 22000 |
  >
  > [도서B]
  >
  > | 도서번호 | 이름        | 출판사     | 가격  |
  > | -------- | ----------- | ---------- | ----- |
  > | 1        | 축구의 역사 | 굿스포츠   | 7000  |
  > | 4        | 골프 바이블 | 대한미디어 | 35000 |
  > | 5        | 피겨 교본   | 굿스포츠   | 8000  |
  >
  > == 도서A ∩ 도서B
  >
  > | 도서번호 | 이름        | 출판사   | 가격 |
  > | -------- | ----------- | -------- | ---- |
  > | 1        | 축구의 역사 | 굿스포츠 | 7000 |
- **차집합(Difference)**  
  첫 번째 릴레이션에는 속하고 두 번째 릴레이션에는 속하지 않는 투플을 반환
  > 예시)  
  > [도서A]
  >
  > | 도서번호 | 이름          | 출판사     | 가격  |
  > | -------- | ------------- | ---------- | ----- |
  > | 1        | 축구의 역사   | 굿스포츠   | 7000  |
  > | 2        | 축구아는 여자 | 나무수     | 13000 |
  > | 3        | 축구의 이해   | 대한미디어 | 22000 |
  >
  > [도서B]
  >
  > | 도서번호 | 이름        | 출판사     | 가격  |
  > | -------- | ----------- | ---------- | ----- |
  > | 1        | 축구의 역사 | 굿스포츠   | 7000  |
  > | 4        | 골프 바이블 | 대한미디어 | 35000 |
  > | 5        | 피겨 교본   | 굿스포츠   | 8000  |
  >
  > == 도서A ∩ 도서B
  >
  > | 도서번호 | 이름        | 출판사   | 가격 |
  > | -------- | ----------- | -------- | ---- |
  > | 1        | 축구의 역사 | 굿스포츠 | 7000 |
- **카티전 프로젝트(Cartesian Product)**  
  첫 번째 릴레이션의 오른쪽에 두 번째 릴레이션의 모든 투플을 순서대로 배열하여 반환
  > 예시)  
  > [고객]
  >
  > | 고객번호 | 이름   | 주민번호       | 주소     | 핸드폰        |
  > | -------- | ------ | -------------- | -------- | ------------- |
  > | 1        | 박지성 | 810000-0000000 | 영국     | 010-5000-0001 |
  > | 2        | 김연아 | 900000-0000000 | 대한민국 | 010-6000-0001 |
  > | 3        | 장미란 | 830000-0000000 | 대한민국 | 010-7000-0001 |
  > | 4        | 추신수 | 820000-0000000 | 미국     | 010-8000-0001 |
  >
  > [주문]
  >
  > | 주문번호 | 고객번호 | 도서번호 | 판매가격 | 주문일자   |
  > | -------- | -------- | -------- | -------- | ---------- |
  > | 1        | 2        | 1        | 7000     | 2014-07-01 |
  > | 2        | 1        | 2        | 13000    | 2014-07-03 |
  > | 3        | 2        | 5        | 8000     | 2014-07-03 |
  > | 4        | 1        | 2        | 13000    | 2014-07-04 |
  >
  > == 고객 × 주문
  >
  > | 고객번호 | 이름   | 주민번호       | 주소     | 핸드폰        | 주문번호 | 고객.. | ..  |
  > | -------- | ------ | -------------- | -------- | ------------- | -------- | ------ | --- |
  > | 1        | 박지성 | 810000-0000000 | 영국     | 010-5000-0001 | 1        | 2      | ..  |
  > | 2        | 김연아 | 900000-0000000 | 대한민국 | 010-6000-0001 | 2        | 1      | ..  |
  > | 3        | 장미란 | 830000-0000000 | 대한민국 | 010-7000-0001 | 3        | 2      | ..  |
  > | 4        | 추신수 | 820000-0000000 | 미국     | 010-8000-0001 | 4        | 1      | ..  |
- **조인(Join)**  
  두 릴레이션의 공통 속성을 기준으로 속성 값이 같은 투플을 수평으로 결합, 조인을 수행하기 위해서는 두 릴레이션의 조인에 참여하는 속성이 서로 동일한 도메인으로 구성되어야 함
- **세타조인과 동등조인**
  - **세타조인(Theta Join)**  
    두 릴레이션의 속성 값을 비교하여 조건(=, ≠, ≤, ≥, ＜, ＞)에 만족하는 튜플을 반환
  - **동등조인(Equi Join) or 내부조인(Inner Join)**  
    세타조인에서 = 연산자를 사용한 조인, 보통 조인 연산이라고 하면 동등조인을 지칭
- **자연조인(Natural Join)**  
  동등조인에서 조인에 참여한 속성이 두 번 나오지 않도록 두 번째 속성을 제거한 결과를 반환
- **외부조인과 세미조인**
  - **외부조인(Outer Join)**  
    자연조인 시 조인에 실패한 투플들을 모두 보여주되, 값이 없는 대응 속성에는 NULL 값을 채워서 반환
    > 예시)  
    > [R1]
    >
    > | A   | B   |
    > | --- | --- |
    > | aa  | 1   |
    > | cc  | 2   |
    > | cc  | 3   |
    >
    > [R2]
    >
    > | B   | C   |
    > | --- | --- |
    > | 1   | dd  |
    > | 3   | ee  |
    > | 4   | ff  |
    >
    > == R1 ⟕(R1.B, R2.B) R2
    >
    > | A   | B   | C    |
    > | --- | --- | ---- |
    > | aa  | 1   | dd   |
    > | cc  | 2   | NULL |
    > | cc  | 3   | ee   |
  - **세미조인(Semi Join)**  
    자연조인을 한 후, 두 릴레이션 중 한쪽 릴레이션의 결과만 반환
- **디비전(Division)**  
  릴레이션의 속성 값의 집합으로 연산을 수행, 특정 값들을 모두 갖고 있는 투플을 찾을 때 사용
  > 예시)  
  > [R]
  >
  > | A   | B   |
  > | --- | --- |
  > | s1  | b1  |
  > | s1  | b2  |
  > | s1  | b3  |
  > | s1  | b4  |
  > | s2  | b1  |
  > | s2  | b2  |
  > | s2  | b4  |
  > | s3  | b1  |
  > | s3  | b2  |
  > | s4  | b4  |
  > | s4  | b1  |
  > | s4  | b2  |
  >
  > [S1]
  >
  > | B   |
  > | --- |
  > | b1  |
  >
  > [S2]
  >
  > | B   |
  > | --- |
  > | b1  |
  > | b3  |
  >
  > [S3]
  >
  > | B   |
  > | --- |
  > | b1  |
  > | b2  |
  > | b4  |
  >
  > == R ÷ S1
  >
  > | A   |
  > | --- |
  > | s1  |
  > | s2  |
  > | s3  |
  > | s4  |
  >
  > == R ÷ S2
  >
  > | A   |
  > | --- |
  > | s1  |
  >
  > == R ÷ S3
  >
  > | A   |
  > | --- |
  > | s1  |
  > | s2  |
  > | s4  |
