# CHAPTER 02 관계 데이터 모델

# 관계 데이터 모델의 개념

## 관계데이터 모델

- 데이터를 2차원 테이블 형태인 릴레이션으로 표현
- 릴레이션에 대한 제약조건constraints와 관계연산을 위한 관계대수relational algebra를 정의
- 관계 데이터베이스시스템은 관계 데이터 모델을 컴퓨터 시스템에 구현한 것

## 특징

- 속성은 단일 값을 갖음
- 한 릴레이션 내의 속성은 서로 다른 이름을 갖음
- 한 속성의 값은 모두 같은 도메인 값을 갖음
- 속성과 투플의 순서는 상관없음
- 릴레이션 내의 투플은 중복되지 않음

## 용어 정리

### relation(릴레이션, 테이블)

- 행과 열로 구성된 테이블

### relationship

- 릴레이션 내에서 생성되는 관계 (데이터들의 관계로 관련있는 실제 데이터들의 집합으로 구성)
- 릴레이션 밖에서 생성되는 관계 (릴레이션에서 다른 릴레이션으로 식별 가능한 값을 이용해서 연결)

### schema

- 릴레이션이 담는 정보(구성) 대한 구조를 정의
- 테이블에서 첫 행인 header에 나타나며, 속성이나 자료타입등의 정보를 담음
- 릴레이션이 갖는 속성의 수 = 차수 degree
- 스키마에 정의되는 각 열은 attribute이며, 각 속성이 가질 수 있는 값을 domain으로 정의
- 표기법 → 릴레이션 이름(속성1:도메인1, 속성2:도메인2)

### instance

- 저장된 스키마에 따라서 테이블에 실제로 저장되는 데이터의 집합
- 한 행row= 투플tuple, 투플의 수=카디날리티cardinality
- 튜플의 속성값은 스키마에서 정의한 도메인 값으로 구성, 투플이 갖는 속성의 개수는 스키마의 차수와 동일

<br/>

# 무결성 제약 조건

## 키

- 릴레이션에서 특정 투플을 식별할 때 사용하는 속성 or 속성의 집합
- 각 릴레이션 간의 관계를 말해주는 연결고리

### 슈퍼키

- 투플을 유일하게 식별할 수 있는 하나의 속성 혹은 속성의 집합

### 후보키

- 투플을 유일하게 식별할 수 있는 속성의 최소 집합
- 효율성 측면에서 중요
- 두 개 이상으로 구성된 키를 복합키composite key라고 함

### 기본키

- 여러 후보키 중에서 하나를 선정해 대표로 삼는 키
- 개인정보가 담긴 key는 사용을 지양
- 릴레이션 스키마를 표현하는 경우 기본키는 하단에 밑줄을 그어 표시

**기본키 제약조건**

- null을 허용하지 않으며, 릴레이션 내 투플을 식별할 수 있는 고유한 값을 가져야함
- 최대한 적은 수의 속성을 가져야함
- 키값의 변동은 일어나선 안되며 향후 키의 사용에 있어 문제 발생 소지가 없어야함

### 대리키

- 적합한 기본키가 없을때 가상의 속성으로 만든 기본 키 → 대리키surrogate key | 인조키artificial key로 부름
- DBMS나 SW에서 임의로 생성하는 값으로 사용자가 직관적인 의미 확인이 어려움

### 대체키

- 기본키로 선정되지 않은 후보키

### 외래키

- 다른 릴레이션의 기본키를 참조하는 속성을 외래키 foreign key라고 함
- 관계 데이터 모델의 특징인 릴레이션 간의 관계를 표현
- 외래키의 성립을 위해서는 참조에 관여하는 양측 릴레이션의 도메인이 서로 같아야함
- 외래키가 기본키의 일부가 될 수 있음
- null과 중복을 허용하여 참조하는 릴레이션은 자기자신과 타 릴레이션 모두 가능

## 무결성 제약 조건

- 데이터 무결성이란 DB에 저장된 데이터의 일관성과 정확성을 지키는 것을 의미
- 무결성을 유지하기 위해 투플의 삽입, 삭제, 수정시 데이터의 제약조건 준수 여부 확인이 요구
- 데이터의 값을 제한 → 도메인 무결성 제약조건
관계 표현 → 개체 무결성 제약조건, 참조 무결성 제약조건

### 도메인 무결성 제약조건

- 도메인 제약이라고도 하며, 각 투플들이 속성의 도메인에 지정된 값만을 가져야한다는 조건
- 속성 값과 관련된 무결성으로 SQL문에서 데이터 형식, 널, 기본 값, 체크 등을 사용하여 지정 가능

### 개체 무결성 제약조건

- 기본키 제약이라고도 하며, 기본키는 무결성원칙에 따라 NULL값을 가져서는 안되며 오직 하나의 값으로 존재해야함을 의미

### 참조 무결성 제약조건

- 외래키 제약이라고도 하며, 릴레이션 간의 참조관계를 선언하는 제약조건
- 참조되는 릴레이션→ 부모 릴레이션, 참조 받는 릴레이션→ 자식 릴레이션
- 자식 릴레이션의 외래키는 부모 릴레이션의 기본키와 도메인이 동일해야하며, 자식 릴레이션의 값이 변경될 때 부모 릴레이션의 제약을 받음

**옵션**

- RESTRICTED → 삭제 거부
- CASCADE → 자식 릴레이션의 관련 투플 함께 삭제
- DEFALT → 자식 릴레이션의 관련 투플 defalt값으로 변경
- NULL → 자식릴레이션의 관련 투플 null로 설정

### UNIQUE 제약조건

- 속성의 모든 값들에 서로 같은 값이 없어야하지만, NULL을 허용


<br/>

# 관계대수

코드박사가 관계데이터 모델을 사용하는데 필요한 언어로서 관계대수와 관계해석을 제시

- 관계 대수 : 어떤 데이터를 어떻게 찾는지에 대한 처리 절차를 명시하는 절차적인 언어로 DBMS내부의 처리언어로 사용
- 관계 해석 : 어떤 데이터를 찾는지만 명시하는 선언적인 언어로 SQL의 이론적인 기반을 제공

## 정의

- 릴레이션에서 연산을 이용해 질의하는 방법을 기술하는 언어
- 절차적언어로서 하나 이상의 릴레이션에 연산을 수행해 결과 릴레이션이 나오기까지의 절차를 확인할 수 있는 방법을 제공

## 관계대수식

- 관계 대수 연산을 수행하기 위한 식으로 릴레이션을 결과로 반환
- 대상이 되는 릴레이션과 연산자로 구성되며, 괄호안의 식을 우선으로 왼쪽에서 오른쪽으로 진행
- 단항 연산자 : 연산자<조건> 릴레이션
이항 연산자 : 릴레이션1 연산자<조건> 릴레이션2

## 관계 대수 연산자

- 순수관계 연산 : selection, projection, join, division, rename
- 일반 집합 연산 : union, difference, intersection, cartesian product
- 연산자 중 피연산자의 개수가 한 개인 연산자를 단항 연산자unary operator, 두개인 연산자를 이항 연산자binary operator라고 한다.

### 셀렉션 & 프로젝션

- 하나의 릴레이션을 대상으로하는 단항 연산자, 하나의 릴레이션을 결과로 반환
- 순수관계연산자

**셀렉션**

- 인스턴스의 일부, 투플의 집합을 반환
- 명시한 조건을 만족하는 투플을 반환하므로  결과릴레이션과 대상 릴레이션을 비교할 때, 차수는 동일하며 카디날리티는 작거나 같음

**프로젝션**

- 지정된 속성 값의 일부를 반환
- 결과릴레이션과 대상 릴레이션을 비교할 때, 차수는 작거나 같으며 카디날리티는 동일

### 집합연산

- 수학의 집합 연산과 같은 연산으로 기본연산자 합집합, 차집합, 카티전 프로덕트와 유도된 연산자 교집합 등이 존재
- 결과 릴레이션은 첫번째 릴레이션의 속성 이름을 갖음
- 두개의 릴레이션을 대상으로 하는 이항 연산자
- 카디전 프로덕트를 제외한 관계대수의 집합연산은 속성의 이름과 상관없이 합병가능해야 성립
    
    **합병가능 →** 두 릴레이션의 차수, 도메인, 속성의 순서가 동일함을 의미
    

**합집합 :** 두개의 릴레이션을 합하여 하나의 릴레이션을 반환

**교집합 :** 두 릴레이션이 공통을 갖는 투플을 반환

**차집합 :** 첫번째 릴레이션에는 속하고 두번째 릴레이션에는 속하지 않는 투플을 반환

**카티전 프로덕트**

- 두 릴레이션을 연결시키는 수평적 연산
- 첫번재 릴레이션의 오른쪽에 두 번째 릴레이션의 모든 투플을 순서대로 배열하여 반환하며, 속성과 도메인이 동일할 필요가 없음
- 결과릴레이션의 차수는 두 릴레이션의 차수의 합이며 카디날리티는 두 릴레이션의 카디날리티의 곱
- 동일한 속성명을 두 릴레이션이 모두 갖는 경우, 속성이름 ‘릴레이션명.속성이름’ | 위치변경 을 통해 표현

### 조인

- 두 릴레이션의 공통 속성을 기준으로 속성 값이 같은 투플을 수평으로 결합하는 연산
- 조인에 참여하는 속성은 서로 동일한 도메인으로 구성
- 기본조인연산 : 세타조인, 동등조인, 자연조인
확장된조인연산 : 세미조인, 외부조인

**세타조인 :** 조인에 참여하는 두 릴레이션의 속성 값을 비교하여 조건 { =, ≠, ≤, ≥, >, < }에 만족하는 투플만 반환하는 것

**동등조인** : 세타조인에서 = 연산자를 사용한 조인

**자연조인** : 동등조인에서 조인에 참여한 속성이 두번 노출되지 않도록 두번째 속성을 제거한 결과를 반환

**외부조인**

- 자연조인시 조인에 실패한 투플을 모두 보여주되, 값이 없는 대응 속성은 NULL로 반환
- 모든 속성을 노출하는 기준 릴레이션의 위치에 따라 왼쪽외부조인, 오른쪽외부조인, 완전외부조인으로 나눔

**세미조인** : 자연조인한 릴레이션 중 한쪽 릴레이션의 결과만 반환

### 디비전

- R1 **÷** R2일때,  릴레이션 R1(X)와 릴레이션 R2(Y)에 대하여 Y ⊆ X이고  R1(X) = R1(X-Y,Y)이므로 R2(Y)의 모든 튜플에 연관되어 있는 S1[X-Y]의 튜플을 선택하는 것