# CHAPTER 07 정규화

# 정규화

## 이상현상 anomoly

### 개념

아래 현상이 발생하는 것

- 삽입 시, 특정 속성에 해당하는 값이 없어 NULL값이 입력: 삽입이상 insertion anomaly
- 삭제 시, 같이 저장된 다른 정보까지 연쇄삭제 현상: 삭제이상deletion anomaly
- 수정 시, 중복된 데이터의 일부만 수정되어 데이터의 일관성이 훼손(inconsistency)되는 현상 :수정이상update anomaly

<br/>

## 함수 종속성 functionally dependency

### 개념

- 어떤 속성 A의 값을 알면 다른 속성 B의 값이 유일하게 정해지는 의존관계<br/>
= 속성 B는 속성 A에 종속한다 functionally dependent<br/>
= 속성 A는 속성 B를 함수적으로 결정한다 determine<br/>
= (표기)A->B<br/>
= A는 B의 결정자determinant, B는 종속속성 dependent attribute<br/>
- 함수 종속성(FD, functionally dependency, 함수적 종속성)

### 표기법 functionally dependency diagram

- 함수종속성 다이어그램 fuctional dependency diagram)
    - 릴레이션의 속성: 직사각형
    - 속성 간의 함수 종속성: 화살표
    - 복합 속성: 직사각형으로 묶어 표기

### 규칙 functionally dependency rule

- 부분 집합(subset) 규칙: If Y ⊆ X, then X → Y
- 증가(augmentation) 규칙 : If X → Y then XZ → YZ
- 이행(transitivity) 규칙 : If X → Y and Y → Z then, X → Z
- 결합 규칙(union) : If X → Y and X → Z then, X → YZ
- 분해(decomposition) 규칙 : If X → YZ, then X → Y and X → Z
- 유사이행(pseudotransitivity) 규칙: If X -> Y and WY → Z, then WX → Z

### 결정자

결정자 관련 **기본키**

- 릴레이션 R(K, A1, A2, A3, …An)에서 K가 기본키이면, K→R이 성립하므로 기본키는 릴레이션의 모든 속성에 대해 결정자(determinant)

결정자 관련 **이상현상 발생 원인**

- 기본키가 아니면서 결정자인 속성(비후보키 결정자 속성)이 있을 때 발생
→ (비후보키 결정자 속성+비후보키 결정자 속성이 결정하는 속성)이 하나의 릴레이션을 갖도록 분해
    - 부분 릴레이션의 결정자는 원래 릴레이션에 속성으로 존재해야 관계를 형성할 수 있음

<br/>

## 정규화nomalization

### 개념

- 이상현상이 발생하는 테이블을 분해하여 이상현상을 없애는 과정
- 이상현상을 일으키는 함수 종속성의 유형에 따라 정규형의 개념으로 구분하며, 정규형이 높을수록 이상현상은 줄어듦

### 특징

- BCNF까지 정규화하면 실제적인 이상현상이 없어지므로 보통 이 단계까지 진행
- 원자값을 만족하지 않는 속성을 가진 상태에서 원자값을 만족하는 형태로 정규화된 경우 제 1정규형이 될 수도있지만, 제 2정규형, 제 3정규형이 될 수도 있음 → 정규화를 통해 정규형이 단계별로 달성되는 것이 아니라 만족하는 정규형에 속하는 것

### 제 1 정규형

- 조건: 릴레이션 R의 모든 속성 값이 원자값을 가진다

- 분해 전<br/> 속성값이 원자 값을 갖도록 분해한다.
ex) 속성 값이 원자 값이 아닌 경우
    
    
    | 이름 | 취미 |
    | --- | --- |
    | 김영환 | 영화, 음악 |
    | 고건 | 음악 |
    | 김민 | 쇼핑, 게임, 영화 |

- 분해 후
    
    
    | 이름 | 취미 |
    | --- | --- |
    | 김영환 | 영화 |
    | 김영환 | 음악 |
    | 고건 | 음악 |
    | 김민 | 쇼핑 |
    | 김민 | 게임 |
    | 김민 | 영화 |

### 제 2 정규형

- 조건: 릴레이션 R이 제 1정규형이고 기본키가 아닌 속성이 완전 함수 종속이다

<aside>
💡 완전 함수 종속
A와 B가 릴레이션 R의 속성이고 A→B 종속성이 성립할 때, B가 A의 속성 전체에 함수 종속하고 부분 집합 속성에 함수 종속하지 않는 경우

</aside>

- 릴레이션의 기본키가 복합키인 경우, 복합키의 일부가 다른 속성의 결정자인지 여부를 판단하는 것
- 불완전 함수 종속(부분 함수 종속, partial functional dependency) → 기본키의 일부를 제거해도 종속성이 여전히 성립하는 경우
- 불완전 함수 종속이 없도록 릴레이션 분리
ex) 강좌이름이 강의실을 종속하는 경우 <br/>
수강강좌(학생번호, 강좌이름, 강의실, 성적) → 수강(학생번호, 강좌이름, 성적), 강의실(강좌이름, 강의실)

### 제 3 정규형

- 조건: 릴레이션 R이 제 2정규형이고 기본키가 아닌 속성이 기본키에 비이행적non-transitive으로 종속하는 경우(직접 종속)
    
    <aside>
    💡 이행적 종속<br/>
    A→B, B→C가 성립 할 때 A→C가 성립되는 함수 종속성
    
    </aside>
    
- 속성들이 이행적transitive으로 종속되어있는지 여부를 판단하는 것
- 이행적 종속이 없도록 분해
ex) 계절학기 릴레이션의 속성(강좌이름)이 계절학기 릴레이션 다른 속성(수강료)를 종속하는 경우<br/>
계절학기(학생번호, 강좌이름, 수강료) → 계절수강(학생번호, 강좌이름), 수강료(강좌이름, 수강료)

### 제 4 정규형

- 조건: 릴레이션 R이 제 3정규형이고 다치종속성multivalued dependency이 없는 경우
- 다치종속 조건
    - A->B 일 때 하나의 A값에 여러 개의 B값이 존재하는 경우(1:n), 다치 종속성을 가진다고 하고 A↠B라고 표시
    - 최소 3개의 칼럼이 존재
        - 한 릴레이션에서 1 대 N으로 관계가 나타나도 되지만,  1 : N, 1: N 두 개 이상이 나타나는 경우에 문제 발생
    - R(A, B, C)의 상황에서, A와 B 사이에 다치 종속성 존재 & B와 C가 독립적

- 분해 전
    | 학생번호(A) | 과목(B) | 취미(C) |
    | --- | --- | --- |
    | 101 | 자바 | 노래 |
    | 101 | 파이썬 | 게임 |
    | 102 | 운영체제 | 노래 |
    | 102 | 데이터베이스 | 게임 |
- 문제상황(101번 학생번호로 조회하는 경우 중복발생)
    | 학생번호(A) | 과목(B) | 취미(C) |
    | --- | --- | --- |
    | 101 | 자바 | 노래 |
    | 101 | 자바 | 게임 |
    | 101 | 파이썬 | 노래 |
    | 101 | 파이썬 | 게임 |
- 분해 후(다치 종속성은 유효하나, 2개 이상의 칼럼이 하나의 칼럼에 다치종속하지 않음)
     | 학생번호 | 과목 |
    | --- | --- |
    | 101 | 자바 |
    | 101 | 파이썬 |
    | 102 | 운영체제 |
    | 102 | 데이터베이스 |

    | 학생번호 | 취미 |
    | --- | --- |
    | 101 | 노래 |
    | 101 | 게임 |
    | 102 | 노래 |
    | 102 | 게임 |
### 제 5 정규형

- 조건: 릴레이션 R이 제 4정규형이고 조인종속성join dependency이 없는 경우
- 실무적으로 사용하는 정규형의 최상위 단계로, 이 이상은 릴레이션을 분해해도 의미가 없음
- 조인 종속성 : 하나의 릴레이션을 무손실, 비부가적으로 분해한 이후 다시 join을 거쳤을 때, 원래의 릴레이션으로 복원할 수 있는 경우
- 분해 전
    | 개발자 | 자격증 | 언어 |
    | --- | --- | --- |
    | 홍길동 | 정보처리기사 | C |
    | 홍길동 | 빅데이터 분석 기사 | C++ |
    | 나영석 | 정보처리기사 | C |
    | 이정민 | 정보처리기사 | JAVA |
- 분해 후(조인종속이 없는 모델로 변형)
    | 개발자 | 자격증 |
    | --- | --- | 
    | 홍길동 | 정보처리기사 |
    | 홍길동 | 빅데이터 분석 기사 |
    | 나영석 | 정보처리기사 |
    | 이정민 | 정보처리기사 | 

    | 자격증| 언어 |
    | --- | --- | 
    | 정보처리기사 | C |
    | 빅데이터 분석 기사 | C++ |
    | 정보처리기사 | C |
    | 정보처리기사 | JAVA |

    | 개발자 |언어 |
    | --- | --- | 
    | 홍길동  | C |
    | 홍길동  | C++ |
    | 나영석  | C |
    | 이정민  | JAVA |

    <img width="936" alt="스크린샷 2023-01-15 오후 12 19 02" src="https://user-images.githubusercontent.com/75975946/212521284-1d626475-e8a6-420f-8d88-6edaa057a7fe.png">

### BCNF 정규형

- boyce codd normal form 정규형 → 릴레이션 R에서 함수 종속성 X→Y가 성립할 때 모든 결정자 X가 후보키인 정규형
- ex)결정자이지만 후보키가 아닌 속성(교수)이 존재
특강수강(학생번호, 특강이름, 교수) → 특강신청(학생번호, 교수), 특강 교수(특강 이름, 교수)

### 무손실 분해

- 정의: 무손실 분해lossless-join decomposition → 릴레이션 R을 R1과 R2로 분해할 때, R1**⋈**R2=R를 만족하는 경우
- 조건: R1 **∩** R2 → R1의 key | R1 **∩** R2 → R2의 key 만족
- 분해된 릴레이션 간의 relationship을 유지하기 위해 분해된 릴레이션에 공통 속성을 한 개 이상 존재해야함
- 공통 속성은 분해된 릴레이션을 다시 원래의 릴레이션으로 join할때 사용
- 조건을 만족하지 않고 key가 아닌 일반 속성을 공통속성을 갖는 경우 손실loss 분해 됨
![무손실분해예시자료](https://user-images.githubusercontent.com/75975946/212514332-b7671610-39a9-41cf-9e8f-1e23c48fd5e3.jpeg)

<br/>

## 반정규화

### 개념
- 반정규화(=역정규화, denormalization)은 정규화를 수행하지 않은 모델을 지칭
- 정규화된 entity, attribute, relationship에 대해 중복, 통합, 분리 등을 수행하는 데이터 모델링 기법
- 데이터 무결성이 깨질수 있음에도 불구하고 데이터 중복을 허용함으로서 join을 줄임으로 성능을 향상시키기 위한 기법

    <aside>
    💡성능저하 발생의 예상되는 경우<br/>
    - 너무 많은 디스크 I/O량<br/>
    - 너무 먼거리로 인한 많은 량의 조인
    </aside>
