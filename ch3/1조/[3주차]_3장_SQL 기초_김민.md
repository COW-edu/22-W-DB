# Chapter 03 SQL 기초

# 01 SQL 학습을 위한 준비

(교재 참조)

# 02 SQL 개요

DBMS에게 원하는 내용을 알려주고 결과를 얻는 데 사용하는 데이터베이스 전용 언어가 SQL이다. DBMS는 SQL 문을 해석하고 프로그램으로 변환하여 실행한 후 결과를 알려준다. SQL은 데이터를 다루는 데 있어서 자바, C++, C 같은 일반 프로그래밍 언어보다 훨씬 쉽고 편리하다. 하지만 완전한 프로그래밍 언어는 아니다. 대신 데이터 부속어라고 부른다.

SQL은 기능에 따라 데이터 정의어DDL. Data Definition Language와 데이터 조작어DML. Data Manipulation Language, 데이터 제어어DCL. Data Control Language로 나뉜다.

- 데이터 정의어(DDL) : 테이블이나 관계의 구조를 생성하는 데 사용하며 CREATE, ALTER, DROP 문 등이 있다.
- 데이터 조작어(DML) : 테이블에 데이터를 검색, 삽입, 수정, 삭제하는 데 사용하며 SELECT, INSERT, DELETE, UPDATE 문 등이 있다. 여기서 SELECT 문은 특별히 질의어query라고 부른다.
- 데이터 제어어(DCL) : 데이터의 사용 권한을 관리하는 데 사용하며 GRANT, REVOKE 문등이 있다.

# 03 데이터 조작어 - 검색

SQL SELECT 문은 데이터를 검색하는 기본 문장으로, 특별히 질의어query 라고 부른다. SELECT 문은 검색한 결과를 테이블 형태로 출력한다.

## 1 SELECT 문

- SELECT/FROM
- WHERE 조건
    - 비교 ; =,<>, <, <=, >, ≥
    - 범위 ; BETWEEN
    - 집합 ; IN, NOT IN
    - 패턴 ; LIKE
    - NULL ; IS NULL, IS NOT NULL
    - 복합조건 ; AND, OR, NOT
- ORDER BY ; SQL 문의 실행 결과를 특정 순서대로 출력하고 싶으면 ORDER BY 절을 사용한다.
    - DESC ; 내림차순
    - ASC ; 오름차순

## 2 집계 함수와 GROUP BY

'운영자'가 필요로 하는 질의를 중심으로 SQL의 기능을 살펴본다. 집계를 하기 위해서는 GROUP BY 문을 사용하고 구체적인 집계 내용은 집계 함수를 사용한다.

- 집계 함수
    - 집계 함수는 테이블의 각 열에 대해 계산을 하는 함수로 SUM, AVG, MIN, MAX, COUNT의 다섯 가지가 있다.
    - 의미 있는 열 이름을 출력하고 싶으면 속성이름의 별칭을 지칭하는 AS 키워드를 사용하여 열 이름을 부여한다.
    - 집계 함수는 WHERE 문과 같이 사용하면 더 유용하다.
    - 집계 함수는 여러 개를 혼합하여 쓸 수 있다.
    - 집계 함수 COUNT는 행의 개수를 센다. COUNT()의 괄호 안에는 * 혹은 특정 속성의 이름이 사용되며, 해당 속성의 투플의 개수를 세어준다(NULL 값은 제외).
- GROUP BY
    - 속성 값이 같은 값끼리 그룹을 만들 수 있다.
    - HAVING 절은 GROUP BY 절의 결과 나타나는 그룹을 제한하는 역할을 한다.

## 3 두 개 이상 테이블에서 SQL 질의

SQL은 여러 개의 테이블을 이용하여 질의하는 두 가지 방법을 제공한다. 조인join과 부속질의ubquery다.

- 조인 : 테이블의 행을 다른 테이블의 행에 연결하여 두 개 이상의 테이블을 결합하는 연산
    - 테이블 조인 : 여러 개의 테이블을 연결하여 하나의 테이블을 만드는 과정
    - 동등 조인(내부 조인) : 동등조건에 의하여 테이블을 조인하는 것
    - 조인이라고 하면 대부분 동등조인을 말한다.
    - 조인을 사용하면 두 개 이상의 테이블에서 일부 데이터만 얻을 수 있다.
    - 모든 SQL 질의의 결과는 단일 테이블이다.
    - 세 개 이상의 테이블을 조인할 수도 있다.
    - WHERE 절을 추가하여 원하는 결과만 추출할 수도 있다.
    - 외부조인outer join : FROM 절에 조인 종류를 적고 ON을 이용하여 조인 조건을 명시한다.
- 부속질의 : SELECT 문의 WHERE 절에 또 다른 테이블 결과를 이용하기 위해 다시 SELECT 문을 괄호로 묶는 것
    - 질의가 중첩되어 있다는 의미에서 중첩질의nested query라고도 한다.
    - 실행 순서는 WHERE 절의 부속질의를 먼저 처리하고 전체질의를 처리한다.
    - 부속질의는 SQL 문이다. SQL 문의 결과는 테이블이며 테이블의 결과는 다음 네 가지 중 하나가 된다.
    단일행-단일열(1x1), 다중행-단일열(nx1), 단일행-다중열(1xn), 다중행-다중열(nxn)
    - 세 개 이상의 중첩된 부속질의도 가능하다.
    - 부속질의 간에는 상하관계가 있으며, 실행 순서는 하위 부속질의를 먼저 실행하고 그 결과를 이용하여 상위 부속질의를 실행한다.
    - 상관 부속질의correlated subquery : 상위 부속질의의 투플을 이용하여 하위 부속질의를 계산한다.
    - 조인은 부속질의가 할 수 있는 모든 것을 할 수 있다.
    - 한 개의 테이블에서만 결과를 얻는 여러 테이블 질의는 조인보다 부속질의로 작성하는 것이 훨씬 편하다.
- 집합 연산
    
    SQL 문의 결과는 테이블로 나타난다. 테이블은 투플의 집합이므로 테이블 간의 집합 연산을 이용하여 합집합, 차집합, 교집합을 구할 수 있다.
    
    - 합집합을 UNION으로 나타낸다.
    - UNION ALL 연산자는 중복을 포함하여 모든 결과를 구한다.
- EXISTS
    - 상관 부속질의문 형식이다. EXISTS는 원래 단어에서 의미하는 것과 같이 조건 에 맞는 투플이 존재하면 결과에 포함시킨다.
    - 반면 NOT EXISTS는 부속질의문의 모든 행이 조건에 만족하지 않을 때만 참이다.

# 04 데이터 정의어

데이터를 저장하려면 먼저 데이터를 저장할 테이블의 구조를 만들어야 한다. SQL의 데이터 정의어DDL, Data Definition Language는 바로 이 구조를 만드는 명령이다. 테이블의 구조를 만드는 CREATE 문, 구조를 변경하는 ALTER 문, 구조를 삭제하는 DROP 문이 있다.

## 1 CREATE 문

CREATE 문은 테이블을 구성하고, 속성과 속성에 관한 제약을 정의하며, 기본키 및 외래키를 정의하는 명령이다.

기본키 속성에 괄호는 필수다.

두개의 속성이 기본키가 된다면 괄호를 사용하여 복합키를 지정한다.

외래키 제약조건을 명시할 때는 주의할 점이 있다. 반드시 참조되는 테이블(부모 릴레이션)이 존재해야 하며 참조되는 테이블의 기본키여야 한다. 외래키 지정 시 ON DELETE 옵션은 참조되는 테이블의 투플이 삭제될 때 취할 수 있는 동작을 지정한다.

## 2 ALTER 문

ALTER 문은 생성된 테이블의 속성과 속성에 관한 제약을 변경하며 기본키 및 외래키를 변경한다.

ALTER 문에서 ADD, DROP은 속성을 추가하거나 제거할 때 사용하고 MODIFY는 속성을 변경할 때 사용한다.

속성을 추가하려면 ALTER 문을 사용해야 한다.

## 3 DROP 문

DROP 문은 테이블을 삭제하는 명령이다. DROP 문은 테이블의 구조와 데이터를 모두 삭제하므로 사용에 주의해야 한다. 데이터만 삭제하려면 DELETE 문을 사용한다.

# 05 데이터 조작어 - 삽입, 수정, 삭제

## 1 INSERT 문

INSERT 문은 테이블에 새로운 투플을 삽입하는 명령이다.

새로운 투풀을 삽입할 때 속성의 이름은 생략할 수 있다. 이때 데이터의 입력 순서는 속성의순서와 일치해야 한다.

데이터는 항상 속성의 순서대로 입력하지 않아도 된다.

만약 몇 개의 속성만 입력해야 한다면 해당되는 속성만 명시하면 된다.

INSERT 문은 SELECT 문을 사용하여 작성할 수도 있다. 이는 한꺼번에 여러 개의 투플을 삽입하는 방법으로 대량 삽입bulk insert 이라고도 한다.

## 2 UPDATE 문

UPDATE 문은 특정 속성 값을 수정하는 명령이다.

UPDATE 문은 다른 테이블의 속성 값을 이용할 수도 있다.

## 3 DELETE 문

DELETE 문은 테이블에 있는 기존 투플을 삭제하는 명령이다.

DELETE 문은 <검색조건>에 해당되는 투플을 삭제한다. <검색조건>이 없으면 모든 투플을 삭제한다.

제약이 해제되지 않으면 데이터 삭제가 중지된다.